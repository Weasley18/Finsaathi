# Add Comprehensive Advisor Signup Fields

The objective is to gather extensive compliance, certification, and business information when a user signs up as a Financial Advisor. Because of the volume of new fields, a new `AdvisorProfile` database model will be introduced.

## Proposed Changes

### Database Layer
#### [MODIFY] [schema.prisma](file:///c:/Users/aadit/OneDrive/Desktop/mini_project/hackathon/Finsaathi/backend/prisma/schema.prisma)
Add a new `AdvisorProfile` model that has a one-to-one relationship with `User`. 
It will include:
- `businessAddress`, `professionalEmail`
- `sebiCertificateIssueDate`, `sebiCertificateExpiryDate`, `baslMembershipId`
- `highestQualification`, `optionalCertifications` (String Array)
- `languagesSpoken` (String Array), `areasOfExpertise` (String Array), `feeModel` (Enum)

*Add `areasOfInterest` (String Array) to the `User` model. This will allow end-users to specify exactly what kind of advice they need (e.g. Micro-savings, Debt Management) to match with the Advisor's `areasOfExpertise`.*

*Document uploads (PDFs for SEBI, mandatory NISM X-A/X-B, PAN, Aadhaar, etc.) will be handled using the existing `Document` model.*

---

### Backend API
#### [MODIFY] [auth.ts](file:///c:/Users/aadit/OneDrive/Desktop/mini_project/hackathon/Finsaathi/backend/src/routes/auth.ts)
- Expand the `profileSchema` (Zod validator) to parse the new advisor fields, and also parse `areasOfInterest` for `END_USER`s.
- In the `/complete-profile` route, if `role === 'ADVISOR'`, extract the advisor-specific fields and create an `AdvisorProfile` record linked to the `userId`. The `approvalStatus` will inherently be set to `PENDING` until an Admin verifies the data and approves the advisor.
- We will update the Advisor listing/matching API to query and return advisors whose `areasOfExpertise` overlap with the caller's `areasOfInterest`.
- Any document IDs passed from the frontend (which handles uploads via the `/upload` endpoint first) will be associated with the User.

---

### Frontend Web App
#### [MODIFY] [OnboardingPage.jsx](file:///c:/Users/aadit/OneDrive/Desktop/mini_project/hackathon/Finsaathi/web-app/src/pages/OnboardingPage.jsx)
- Transform the Advisor sign-up form into a more comprehensive, step-by-step or larger scrollable form. 
- Introduce state variables for all the new fields:
  - **Identity**: profilePicture (URL handling), email, address 
  - **Compliance**: validity dates, BASL ID
  - **Education**: qualification, optional certification multi-select dropdowns. *Mandatory certificates (NISM X-A, X-B) will not be in the dropdown, as they are implicitly required via document uploads.*
  - **Profiling**: languages, expertise, fee model (These will use strict `<select>` dropdown menus instead of free-text inputs).
- **End User Sign-up**: Add an `areasOfInterest` multi-select dropdown for `END_USER`s, allowing them to choose their desired fields of advice.
- **Document Uploads**: Implement a mechanism to select PDF files. Before submitting the final profile payload, these files will be uploaded sequentially to the [api.js](file:///c:/Users/aadit/OneDrive/Desktop/mini_project/hackathon/Finsaathi/web-app/src/api.js) (pointing to `/upload` API) to get their document IDs/Storage Keys.
- Submit the aggregated JSON payload to `/complete-profile`.

#### [MODIFY] [api.js](file:///c:/Users/aadit/OneDrive/Desktop/mini_project/hackathon/Finsaathi/web-app/src/api.js)
- Ensure there is a method `uploadDocument(file, type)` exported for [OnboardingPage.jsx](file:///c:/Users/aadit/OneDrive/Desktop/mini_project/hackathon/Finsaathi/web-app/src/pages/OnboardingPage.jsx) to use.

## Verification Plan

### Manual Verification
1. Start the Fastify backend server and Prisma Studio.
2. Start the Vite React web app.
3. Open the Web App, enter phone number, OTP, and select "Financial Advisor" on the [OnboardingPage](file:///c:/Users/aadit/OneDrive/Desktop/mini_project/hackathon/Finsaathi/web-app/src/pages/OnboardingPage.jsx#6-162).
4. Fill out the heavily expanded form, using the new Dropdowns (Expertise, Fee Model). Proceed to upload test PDF documents for the mandatory certificates.
5. Submit the form.
6. Verify via the UI that we are redirected to `/waiting-room` and the status is PENDING and awaits Admin approval.
7. Verify via Prisma Studio that an `AdvisorProfile` is created successfully and linked to the `User`.
8. Complete the profile setup for an `END_USER` as well, selecting "Debt Management" as an area of interest, and securely test the matching logic to ensure that an `ADVISOR` with "Debt Management" expertise is highly ranked/shown.
